<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SolarTrack">
  <meta name="theme-color" content="#0a0e1a">
  <meta name="description" content="Evidence pr√°ce na sol√°rn√≠ch pol√≠ch">

  <title>SolarTrack</title>

  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png">
  <link rel="stylesheet" href="./style.css">
</head>
<body>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- CONFIRM DIALOG -->
  <div class="confirm-overlay" id="confirmOverlay">
    <div class="confirm-box">
      <h3 id="confirmTitle">Potvrdit</h3>
      <p id="confirmMessage">Opravdu chcete pokraƒçovat?</p>
      <div class="confirm-actions">
        <button class="btn btn-secondary" onclick="closeConfirm()">Zru≈°it</button>
        <button class="btn btn-danger" id="confirmBtn" onclick="">Smazat</button>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="app-header">
    <div class="header-top">
      <div class="app-logo">
        <div class="logo-icon">‚òÄÔ∏è</div>
        <div>
          <div class="app-title">SolarTrack</div>
          <div class="app-subtitle">Evidence pr√°ce</div>
        </div>
      </div>
      <button class="btn btn-sm btn-secondary" onclick="openPage('settings')" title="Nastaven√≠">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </button>
    </div>
    <div class="header-project" id="headerProject" style="display:none">
      <select id="projectSelect" onchange="onProjectChange()">
        <option value="">Vyber projekt...</option>
      </select>
    </div>
  </header>

  <!-- ============ STR√ÅNKA: Z√ÅZNAMY ============ -->
  <div class="page active" id="pageDashboard">
    <!-- T√Ωdenn√≠ souhrn -->
    <div class="week-summary" id="weekSummary" style="display:none">
      <div class="week-summary-title">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Tento t√Ωden
      </div>
      <div class="week-summary-stats">
        <span id="weekDays">0 dn≈Ø</span>
        <span class="week-divider">¬∑</span>
        <span id="weekHours">0h</span>
        <span class="week-divider">¬∑</span>
        <span id="weekStrings">0s</span>
      </div>
    </div>

    <!-- Filtr podle zamƒõstnance -->
    <div class="dash-filter" id="dashFilter" style="display:none">
      <select id="dashEmployeeFilter" onchange="loadDashboard()">
        <option value="">V≈°ichni zamƒõstnanci</option>
      </select>
    </div>

    <div id="dashboardContent"></div>
  </div>

  <!-- ============ STR√ÅNKA: P≈òEHLEDY ============ -->
  <div class="page" id="pageStats">
    <h2 class="page-title">üìä P≈ôehledy</h2>

    <div class="month-picker">
      <label style="margin:0;white-space:nowrap">Mƒõs√≠c:</label>
      <input type="month" id="statsMonth" onchange="loadStats()">
      <button class="btn btn-sm btn-secondary" onclick="document.getElementById('statsMonth').value='';loadStats()">V≈°e</button>
    </div>

    <div class="stats-grid" id="statsGrid">
      <div class="stat-card">
        <div class="stat-value blue" id="statHours">0</div>
        <div class="stat-label">Celkem hodin</div>
      </div>
      <div class="stat-card">
        <div class="stat-value amber" id="statStrings">0</div>
        <div class="stat-label">Celkem string≈Ø</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="statDays">0</div>
        <div class="stat-label">Pracovn√≠ch dn≈Ø</div>
      </div>
      <div class="stat-card">
        <div class="stat-value blue" id="statAvg">0</div>
        <div class="stat-label">√ò hodin / den</div>
      </div>
    </div>

    <!-- P≈ôehled po zamƒõstnanc√≠ch -->
    <div class="section-header">
      <h3 class="section-title">üë∑ P≈ôehled po zamƒõstnanc√≠ch</h3>
    </div>
    <div id="employeeStatsContainer"></div>

    <!-- Grafy -->
    <div class="section-header mt-16">
      <h3 class="section-title">üìà Grafy</h3>
    </div>

    <div class="chart-container">
      <div class="chart-title">Hodiny / den</div>
      <div class="chart-wrapper"><canvas id="chartHours"></canvas></div>
    </div>

    <div class="chart-container">
      <div class="chart-title">Stringy / den</div>
      <div class="chart-wrapper"><canvas id="chartStrings"></canvas></div>
    </div>

    <div class="chart-container">
      <div class="chart-title">Hodinovka vs √ökol</div>
      <div class="chart-wrapper"><canvas id="chartComparison"></canvas></div>
    </div>

    <!-- Export po zamƒõstnanc√≠ch -->
    <div class="section-header mt-16">
      <h3 class="section-title">üì§ Export</h3>
    </div>

    <div class="form-group">
      <label>Zamƒõstnanec (pr√°zdn√© = v≈°ichni)</label>
      <select id="exportEmployee">
        <option value="">V≈°ichni zamƒõstnanci</option>
      </select>
    </div>
    <div class="form-group">
      <label>Mƒõs√≠c (pr√°zdn√© = cel√Ω projekt)</label>
      <input type="month" id="exportMonthStats">
    </div>
    <button class="btn btn-green btn-full" onclick="doExportFromStats()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      St√°hnout CSV
    </button>
  </div>

  <!-- ============ STR√ÅNKA: ZAMƒöSTNANCI ============ -->
  <div class="page" id="pageEmployees">
    <h2 class="page-title">üë∑ Zamƒõstnanci</h2>
    <div class="inline-add">
      <input type="text" id="newEmployeeName" placeholder="Jm√©no zamƒõstnance" enterkeyhint="done">
      <button class="btn btn-primary btn-icon" onclick="addNewEmployee()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
    </div>
    <div id="employeeList"></div>
  </div>

  <!-- ============ STR√ÅNKA: NASTAVEN√ç ============ -->
  <div class="page" id="pageSettings">
    <h2 class="page-title">‚öôÔ∏è Nastaven√≠</h2>

    <h3 style="font-size:15px;margin-bottom:12px;color:var(--text-secondary)">Projekty</h3>
    <div class="inline-add">
      <input type="text" id="newProjectName" placeholder="N√°zev projektu" enterkeyhint="done">
      <button class="btn btn-primary btn-icon" onclick="addNewProject()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
    </div>
    <div id="projectList"></div>

    <div class="export-section">
      <h3 style="font-size:15px;margin-bottom:12px;color:var(--text-secondary)">Export dat</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Mƒõs√≠c</label>
          <input type="month" id="exportMonth">
        </div>
        <div class="form-group">
          <label>Zamƒõstnanec</label>
          <select id="exportEmployeeSettings">
            <option value="">V≈°ichni</option>
          </select>
        </div>
      </div>
      <button class="btn btn-green btn-full mt-8" onclick="doExport()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        St√°hnout CSV
      </button>
    </div>

    <div style="margin-top:32px;padding-top:16px;border-top:1px solid var(--border)">
      <p class="text-sm text-muted text-center">SolarTrack v1.0</p>
      <p class="text-sm text-muted text-center">Data ulo≈æena lok√°lnƒõ v za≈ô√≠zen√≠</p>
      <p class="text-sm text-muted text-center" style="margin-top:4px">Offline-first PWA</p>
    </div>
  </div>

  <!-- ============ MODAL: NOV√ù Z√ÅZNAM ============ -->
  <div class="modal-overlay" id="modalEntry" onclick="closeModalOnBg(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title" id="modalEntryTitle">Nov√Ω z√°znam</div>

      <div class="form-group">
        <label>Zamƒõstnanec</label>
        <select id="entryEmployee">
          <option value="">Vyber zamƒõstnance...</option>
        </select>
      </div>

      <div class="form-group">
        <label>Datum</label>
        <input type="date" id="entryDate">
      </div>

      <div class="form-group">
        <label>Typ pr√°ce</label>
        <div class="work-type-toggle">
          <button class="work-type-btn active-hourly" id="btnHourly" onclick="setWorkType('hourly')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            Hodinovka
          </button>
          <button class="work-type-btn" id="btnTask" onclick="setWorkType('task')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            √ökol / Stringy
          </button>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Hodiny *</label>
          <input type="number" id="entryHours" placeholder="8" step="0.5" min="0" max="24" inputmode="decimal">
        </div>
        <div class="form-group" id="stringsGroup">
          <label>Stringy</label>
          <input type="number" id="entryStrings" placeholder="0" min="0" inputmode="numeric">
        </div>
      </div>

      <div class="form-group">
        <label>ƒå√≠sla stol≈Ø</label>
        <input type="text" id="entryTables" placeholder="nap≈ô. 3E42, 2E80-1">
      </div>

      <button class="btn btn-primary btn-full mt-8" id="btnSaveEntry" onclick="saveEntry()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Ulo≈æit z√°znam
      </button>
    </div>
  </div>

  <!-- ============ MODAL: HROMADN√â ZAD√ÅN√ç ============ -->
  <div class="modal-overlay" id="modalBatch" onclick="closeBatchOnBg(event)">
    <div class="modal-content modal-batch" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title">‚ö° Hromadn√© zad√°n√≠ dne</div>

      <!-- Datum a typ naho≈ôe -->
      <div class="batch-header-controls">
        <div class="form-group" style="flex:1">
          <label>Datum</label>
          <input type="date" id="batchDate">
        </div>
        <div class="form-group" style="flex:1">
          <label>V√Ωchoz√≠ typ</label>
          <div class="work-type-toggle">
            <button class="work-type-btn active-hourly" id="batchBtnHourly" onclick="setBatchWorkType('hourly')">
              ‚è± Hod.
            </button>
            <button class="work-type-btn" id="batchBtnTask" onclick="setBatchWorkType('task')">
              ‚úì √ökol
            </button>
          </div>
        </div>
      </div>

      <!-- Rychl√© hodiny preset -->
      <div class="batch-presets">
        <label>Rychle v≈°em:</label>
        <div class="preset-chips">
          <button class="chip" onclick="batchFillAllHours(8)">8h</button>
          <button class="chip" onclick="batchFillAllHours(10)">10h</button>
          <button class="chip" onclick="batchFillAllHours(12)">12h</button>
          <button class="chip" onclick="batchClearAll()">Vymazat</button>
        </div>
      </div>

      <!-- Seznam zamƒõstnanc≈Ø -->
      <div id="batchEmployeeList" class="batch-employee-list">
        <!-- Dynamicky generovan√© ≈ô√°dky -->
      </div>

      <div class="batch-footer">
        <div class="batch-summary" id="batchSummary">0 z√°znam≈Ø k ulo≈æen√≠</div>
        <button class="btn btn-primary btn-full" onclick="saveBatchEntries()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          Ulo≈æit v≈°e
        </button>
      </div>
    </div>
  </div>

  <!-- FAB GROUP -->
  <div class="fab-group" id="fabGroup" style="display:none">
    <button class="fab-mini" id="fabSingle" onclick="openNewEntry()" title="Jeden z√°znam">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
    </button>
    <button class="fab" id="fabAdd" onclick="openBatchEntry()" title="Hromadn√© zad√°n√≠ dne">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </button>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">
    <button class="nav-btn active" data-page="pageDashboard" onclick="openPage('pageDashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Z√°znamy
    </button>
    <button class="nav-btn" data-page="pageStats" onclick="openPage('pageStats')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      P≈ôehledy
    </button>
    <button class="nav-btn" data-page="pageEmployees" onclick="openPage('pageEmployees')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      T√Ωm
    </button>
    <button class="nav-btn" data-page="pageSettings" onclick="openPage('pageSettings')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Nastaven√≠
    </button>
  </nav>

  <!-- SKRIPTY - relativn√≠ cesty -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="./db.js"></script>
  <script src="./charts.js"></script>
  <script src="./app.js"></script>
</body>
</html>
